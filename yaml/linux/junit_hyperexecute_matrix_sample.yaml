---
version: 0.1
globalTimeout: 150
testSuiteTimeout: 150
testSuiteStep: 150

runson: ${matrix.os}

maxRetries: 1
retryOnFailure: true
concurrency: 3

matrix:
  os: [ "linux"]
  browser: [ "Chrome", "Firefox"]

parallelism: 3

runtime:
  language: java
  version: 11

shell: bash

report : true

pre:
  # install playwright version to be used.
  - npm install playwright@1.23.0 --save-exact
  # Download and install packages in the CACHE_DIR.
  # Skip execution of the tests in the pre step
  - mvn -Dmaven.repo.local=./.m2 -Dmaven.test.skip=true clean install


env:
# PAT : ${{.secrets.testKey}}
TARGET_OS: linux

#Dependency caching for linux
cachekey: '{{checksum "pom.xml"}}'
cacheDirectories:
  - .m2

post:
  - cat yaml/linux/junit_hyperexecute_matrix_sample.yaml

mergeArtifacts: true

uploadArtefacts:
  - name: Surefire-Report
path:
  - target/surefire-reports/**

testDiscovery:
  type: raw
  mode: dynamic
  command: grep -rl '@ParameterizedTest' src/test/java/TestScenarios/*.java | awk -F'/' '{print substr($NF,1,length($NF)-5)}'

#winTestRunnerCommand: mvn test `-Dplatname=win `-Dmaven.repo.local=./.m2 `-Dplatname=win dependency:resolve `-Dtest=$test surefire-report:report
linuxTestRunnerCommand: mvn test -Dplatname=linux -Dmaven.repo.local=./.m2 `-Dplatname=linux dependency:resolve -Dtest=$test surefire-report:report


#testSuites:
#  - mvn test -Dplatname=linux -Dmaven.repo.local=./.m2 -Dtest=$tests

jobLabel: [playwright-Junit, linux, matrix]